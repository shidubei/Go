# Go模块

## 包和模块

* **一个存储库包含一个或多个模块**

* **模块是一起发布的Go包的集合**

* **项目中的依赖就是对其它模块的依赖**

### Package

**package是同一目录中的项目源文件的集合**

**在一个源文件中定义的函数、类型、变量、常量对同一包中的所有其它源文件可见：即同一package下的其它源文件可以调用同一package下的文件**

**代码package和所在目录的名称可以不一致：即包并不于目录进行绑定，实际上的包是由声明包的代码文件组成，其组成可以分散**

**同一目录的Go代码的Package要保持一致：即在声明时要保证声明在同一个package下**

### Main Package

**一个go程序中以main包中的main程序为入口：即程序在从main程序开始执行**

**main包必须含有main函数**

**main函数无参无返回值？**

### Package Init方法(初始化函数)

**在go程序的执行顺序中，变量的初始化先于Init函数的初始化，Init函数的初始化先于main函数的初始化。也就是在执行main函数前，会优先执行Init函数**

**在多个依赖包里的Init函数，会递归执行**

![](C:\Users\86181\AppData\Roaming\marktext\images\2023-02-03-09-31-35-image.png)

**每个包可以有多个init函数**

**包的源文件也可以有多个init函数**

### Go程序的执行顺序

**程序在main包中的main函数入口执行，如果main包里面导入了包，则遵循以下顺序：**

* **如果该包导入了其它的包，则从第一步开始递归执行，但是每个包只会被导入一次(即和Init函数一样递归调用)**

* **以相反的顺序在每个包初始化常量和变量，然后执行该包的Init函数**

* **在其它包准备完成之后，main包执行同样的过程，然后执行main函数执行程序**

## Go Modules(Go语言的模块化管理)

### 常见go mod 命令详解

#### go mod init

**使用go mod init命令来创建一个mod，一个mod的命名为一个路径，且需要确保该路径能被go工具使用**

```go
go mod init example.com/greetings
```

**mod文件用于追踪程序的依赖关系，它只包含模块的名字和该模块支持的go语言版本(语义版本号？)，且随着依赖的增加，mod文件会列出依赖的版本号，用于保证构建的可重复性？(*对于导入的mod，如果mod进行了升级，出现了多个版本，而源文件对不同版本的mod都要使用，那么go mod支持依赖同一mod的不同版本（即将新版本看作是新mod*）)和便于直接对mod版本的控制**

#### go mod edit

**官方解释是通过工具或脚本来校订go.mod文件。**

**如-replace用于替换原mod版本为新mod版本(可以是路径的改变，也可以是版本的升级)**

**如-requires用于增加新mod的依赖**

#### go mod tidy

**官方解释是用于确保go.mod文件中的依赖关系和程序中的调用相匹配。也就是会针对丢失的绑定或者无效的绑定进行增加和移除**

#### go mod download

**官方解释是该命令用于下载命名模块，可以是主模块依赖项的模块模式，也可以是path@version的模块模式**

### mod文件内容初步认识

#### 语义版本号格式

**对于一个导入mod的版本，关于其的版本号如下定义：**

```go-mod
vMAJOR.MINOR.PATCH
/*
v：表示版本
MAJOR:表示主版本，通常是大版本升级
MINOR:表示次版本，通常是向下兼容的版本
PATCH:修订版本，可能是一些bug修复
*/
例如：v1.0.0 v1.1.0 v2.1.0 v2.1.1这种形式
```

#### 文件内容

**对于一个mod文件内容，其包含的信息大致如下：**

```go-mod
/*语言版本*/
go 1.19

/*替换文件*/
replace github.com/rsj217/service v0.0.0 <= github.com/rsj217/service v1.0.0
//表示对原版本或原版本路径的替换，同时require也会更新

/*依赖文件*/
require github.com/rsj217/service v1.0.0
//表示该版本包的依赖
```

### go modules的管理解释

**在go的项目之间采取的是模块化管理。模块是包的集合，包是源文件的集合。项目中很多时候会调用其它模块下的包，且这些模块随着时间的推移可能会逐渐更新或替代，因此项目中对模块的管理十分重要。**

**在1.12版本之前，Go语言采取的是GOPATH环境变量来进行项目管理。在1.12版本之后发布官方工具Go Modules来进行项目模块的管理**

**go modules允许利用go mod命令来对go.mod文件进行管理，go.mod文件包括语言版本信息，替换mod信息，以及依赖mod信息。也就是说，每一个项目在创建的时候都会自动化生成一个go.mod文件，在项目当中进行引用依赖的时候，信息会记录在go.mod文件之中，如果项目之后的依赖会进行修改，我们可以直接在go.mod文件中进行修改，这无疑大大提高了项目的更新或修补的效率。而对go.mod文件进行修改的时候，所要考虑的就是版本，脚本等重要信息**
